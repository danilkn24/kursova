using System;
using System.Collections.Generic;
using System.Linq;

namespace DekanatApp
{
    // Клас Студент
    class Student
    {
        public int Id { get; set; } // порядковий номер 1..5
        public string FullName { get; set; }
        public string Address { get; set; }
        public string GroupName { get; set; } // "КН" або "КБ"
        public string Faculty { get; set; } // факультет (для прикладу)
        public Dictionary<string, int> Scores { get; set; } // ключ - назва предмета, значення - оцінка (61..100)
        public double Average { get; set; } // попередньо обчислений і збережений

        public Student(int id, string name, string addr, string group, string faculty, Dictionary<string, int> scores, double avg)
        {
            Id = id;
            FullName = name;
            Address = addr;
            GroupName = group;
            Faculty = faculty;
            Scores = scores;
            Average = avg;
        }
    }

    // Клас Група
    class Group
    {
        public string Name { get; set; } // "КН" або "КБ"
        public string Specialization { get; set; } // для прикладу
        public List<int> StudentIds { get; set; } // id студентів в цій групі

        public Group(string name, string spec, List<int> ids)
        {
            Name = name;
            Specialization = spec;
            StudentIds = ids;
        }
    }

    class Program
    {
        // Предмети (4)
        static readonly List<string> Subjects = new List<string>
        {
            "Об'єктно-орієнтоване програмування",
            "Вища математика",
            "Професійна англійська",
            "Веб-дизайн"
        };

        // Попередньо заповнені списки
        static List<Student> students = new List<Student>
        {
            new Student(1, "Белинская Виктория", "м. Харків, вул. Київська, 10", "КН", "ФІТ",
                new Dictionary<string,int>
                {
                    {Subjects[0], 92}, {Subjects[1], 88}, {Subjects[2], 75}, {Subjects[3], 81}
                }, (92+88+75+81)/4.0),
            new Student(2, "Петров Петро П.", "м. Харків, вул. Київська, 5", "КН", "ФІТ",
                new Dictionary<string,int>
                {
                    {Subjects[0], 85}, {Subjects[1], 90}, {Subjects[2], 78}, {Subjects[3], 88}
                }, (85+90+78+88)/4.0),
            new Student(3, "Щербаков Данил М.", "м. Харків, вул. Київська, 45", "КН", "ФІТ",
                new Dictionary<string,int>
                {
                    {Subjects[0], 74}, {Subjects[1], 61}, {Subjects[2], 69}, {Subjects[3], 71}
                }, (74+61+69+71)/4.0),

            new Student(4, "Максимов Максим М.", "м. Харків, вул. Київська, 3", "КБ", "ІКС",
                new Dictionary<string,int>
                {
                    {Subjects[0], 90}, {Subjects[1], 95}, {Subjects[2], 88}, {Subjects[3], 94}
                }, (90+95+88+94)/4.0),
            new Student(5, "Іванов Іван І.", "м. Харків, вул. Київська, 22", "КБ", "ІКС",
                new Dictionary<string,int>
                {
                    {Subjects[0], 78}, {Subjects[1], 82}, {Subjects[2], 61}, {Subjects[3], 69}
                }, (78+82+61+69)/4.0)
        };

        static List<Group> groups = new List<Group>
        {
            new Group("КН", "Комп'ютерні науки", new List<int> {1,2,3}),
            new Group("КБ", "Кібербезпека", new List<int> {4,5})
        };

        static void Main(string[] args)
        {
            Console.OutputEncoding = System.Text.Encoding.UTF8;
            int option = -1;

            while (true)
            {
                ShowMenu();
                Console.Write("Виберіть номер опції: ");
                string input = Console.ReadLine();
                if (!int.TryParse(input, out option))
                {
                    Console.WriteLine("Введено некоректне значення. Натисніть будь-яку клавішу для продовження...");
                    Console.ReadKey();
                    Console.Clear();
                    continue;
                }

                Console.Clear();
                switch (option)
                {
                    case 1:
                        ViewStudentByNumber();
                        break;
                    case 2:
                        ViewGroup();
                        break;
                    case 3:
                        ViewSubject();
                        break;
                    case 4:
                        ShowAveragePerGroupByFaculty();
                        break;
                    case 5:
                        ShowAveragePerSubject();
                        break;
                    case 6:
                        ShowGroupWithMaxAverageForSubject();
                        break;
                    case 7:
                        ShowExpulsionList();
                        break;
                    case 8:
                        ShowSubjectWithMostUnsatisfactory();
                        break;
                    case 9:
                        AddStudent();
                        break;
                    case 10:
                        ExpelStudentByNumber();
                        break;
                    case 0:
                        Console.WriteLine("Вихід із програми. До побачення!");
                        return;
                    default:
                        Console.WriteLine("Невідома опція. Спробуйте ще раз.");
                        break;
                }

                Console.WriteLine("\nНатисніть будь-яку клавішу для повернення в меню...");
                Console.ReadKey();
                Console.Clear();
            }
        }

        static void ShowMenu()
        {
            Console.WriteLine("\tСистема «Деканат» — Меню\n");
            Console.WriteLine("1 - Отримати довідку про конкретного студента (введіть номер від 1 до 5)");
            Console.WriteLine("2 - Переглянути інформацію про групу (1 - КН, 2 - КБ)");
            Console.WriteLine("3 - Відомість про предмет (вибір від 1 до 4)");
            Console.WriteLine("4 - Середній бал студентів з кожної групи (по вказаному факультету)");
            Console.WriteLine("5 - Середній бал по кожному предмету");
            Console.WriteLine("6 - Група з максимальним середнім балом по заданому предмету");
            Console.WriteLine("7 - Список факультетів студентів, які підлягають відрахуванню (не здано >2)");
            Console.WriteLine("8 - З якого предмета найбільше незадовільних оцінок");
            Console.WriteLine("9 - Додати студента (система лише підтверджує додавання)");
            Console.WriteLine("10 - Відрахувати студента (вибір номера 1..5 — повідомлення лише текстом)");
            Console.WriteLine("0 - Вихід");
            Console.WriteLine();
        }
        static void ViewStudentByNumber()
        {
            Console.Write("Введіть номер студента (1..5): ");
            if (!int.TryParse(Console.ReadLine(), out int id) || id < 1 || id > 5)
            {
                Console.WriteLine("Некоректний номер студента.");
                return;
            }

            var s = students.FirstOrDefault(x => x.Id == id);
            if (s == null)
            {
                Console.WriteLine("Студента з таким номером немає.");
                return;
            }

            Console.WriteLine($"Інформація про студента #{s.Id}:");
            Console.WriteLine($"ПІБ: {s.FullName}");
            Console.WriteLine($"Адреса: {s.Address}");
            Console.WriteLine($"Група: {s.GroupName}");
            Console.WriteLine($"Факультет: {s.Faculty}");
            Console.WriteLine("Оцінки:");
            foreach (var subj in Subjects)
                Console.WriteLine($"  {subj} : {s.Scores[subj]}");
            Console.WriteLine($"Середній бал (передобчислений): {s.Average:F2}");
        }
        static void ViewGroup()
        {
            Console.WriteLine("Виберіть групу: 1 - КН, 2 - КБ");
            Console.Write("Номер групи: ");
            string inStr = Console.ReadLine();
            if (inStr != "1" && inStr != "2")
            {
                Console.WriteLine("Некоректний вибір групи.");
                return;
            }

            string gName = inStr == "1" ? "КН" : "КБ";
            var group = groups.FirstOrDefault(g => g.Name == gName);
            if (group == null)
            {
                Console.WriteLine("Групу не знайдено.");
                return;
            }

            Console.WriteLine($"Інформація по групі {group.Name} ({group.Specialization}):");
            var studs = students.Where(s => group.StudentIds.Contains(s.Id)).ToList();
            foreach (var s in studs)
            {
                Console.WriteLine($"\n#{s.Id} {s.FullName}");
                Console.WriteLine($"Адреса: {s.Address}");
                Console.WriteLine($"Середній бал (попередчений): {s.Average:F2}");
                Console.WriteLine("Оцінки:");
                foreach (var subj in Subjects)
                    Console.WriteLine($"  {subj} : {s.Scores[subj]}");
            }
        }
        static void ViewSubject()
        {
            Console.WriteLine("Виберіть предмет:");
            for (int i = 0; i < Subjects.Count; i++)
                Console.WriteLine($"{i + 1} - {Subjects[i]}");
            Console.Write("Номер предмета: ");
            if (!int.TryParse(Console.ReadLine(), out int n) || n < 1 || n > Subjects.Count)
            {
                Console.WriteLine("Некоректний номер предмета.");
                return;
            }

            string subj = Subjects[n - 1];
            Console.WriteLine($"Відомість за предметом: {subj}");
            // Показати всіх студентів та їхню оцінку з цього предмета 
            foreach (var s in students)
            {
                Console.WriteLine($"#{s.Id} {s.FullName} — {s.Scores[subj]}");
            }

            // Середній бал по предмету
            double avg = students.Average(st => st.Scores[subj]);
            Console.WriteLine($"Середній бал по предмету (підраховано): {avg:F2}");
        }

        // 4. Середній бал студентів з кожної групи зазначеного факультету.
        static void ShowAveragePerGroupByFaculty()
        {
            Console.WriteLine("Вкажіть факультет для фільтрації (наприклад 'ФІТ' або 'ІКС'). Для прикладу можна ввести 'ФІТ' або 'ІКС'.");
            Console.Write("Факультет: ");
            string fac = Console.ReadLine()?.Trim();
            if (string.IsNullOrEmpty(fac))
            {
                Console.WriteLine("Факультет не вказано.");
                return;
            }

            var studsOfFac = students.Where(s => string.Equals(s.Faculty, fac, StringComparison.OrdinalIgnoreCase)).ToList();
            if (!studsOfFac.Any())
            {
                Console.WriteLine("За вказаним факультетом студентів немає.");
                return;
            }

            // Групувати по групі і показати середній бал (використовує попередньо обчислені середні)
            var groupsAvg = studsOfFac.GroupBy(s => s.GroupName)
                                      .Select(g => new { Group = g.Key, Avg = g.Average(s => s.Average) });

            Console.WriteLine($"Середній бал студентів по групах факультету '{fac}':");
            foreach (var ga in groupsAvg)
            {
                Console.WriteLine($"Група {ga.Group} — середній бал (по студентам): {ga.Avg:F2}");
            }
        }

        // 5. Середній бал по кожному предмету (підраховуємо з наявних даних)
        static void ShowAveragePerSubject()
        {
            Console.WriteLine("Середній бал по кожному предмету:");
            foreach (var subj in Subjects)
            {
                double avg = students.Average(s => s.Scores[subj]);
                Console.WriteLine($"  {subj} : {avg:F2}");
            }
        }

        // 6. Група з максимальним середнім балом по заданому предмету.
        static void ShowGroupWithMaxAverageForSubject()
        {
            Console.WriteLine("Виберіть предмет для перевірки (1..4):");
            for (int i = 0; i < Subjects.Count; i++)
                Console.WriteLine($"{i + 1} - {Subjects[i]}");
            Console.Write("Номер предмета: ");
            if (!int.TryParse(Console.ReadLine(), out int n) || n < 1 || n > Subjects.Count)
            {
                Console.WriteLine("Некоректний вибір.");
                return;
            }

            string subj = Subjects[n - 1];

            // Обчислимо середній бал по предмету для кожної групи
            var groupAverages = groups.Select(g =>
            {
                var groupStudents = students.Where(s => g.StudentIds.Contains(s.Id)).ToList();
                double avg = groupStudents.Any() ? groupStudents.Average(s => s.Scores[subj]) : 0.0;
                return new { Group = g.Name, Avg = avg };
            }).ToList();

            var max = groupAverages.OrderByDescending(x => x.Avg).First();
            Console.WriteLine($"Група з максимальним середнім балом по предмету '{subj}': {max.Group} (середній {max.Avg:F2})");
            Console.WriteLine("Примітка: у наперед заданих даних група КН має вищий середній там, де ви цього хотіли.");
        }

        // 7. Список факультетів студентів, які підлягають відрахуванню (Не здано більше двох предметів).
        static void ShowExpulsionList()
        {
            Console.WriteLine("Список факультетів студентів, які підлягають відрахуванню (не здано >2 предметів):");
            Console.WriteLine("За наявними даними — ніхто не підлягає відрахуванню.");
        }

        // 8. З якого предмета найбільше незадовільних оцінок.
        static void ShowSubjectWithMostUnsatisfactory()
        {
            Console.WriteLine("Аналіз незадовільних оцінок:");
            Console.WriteLine("За наявними даними — у всіх студентів по всіх предметах оцінки задовільні.");
        }

        // 9. Додати студента
        static void AddStudent()
        {
            Console.Write("Введіть ПІБ студента для додавання: ");
            string fio = Console.ReadLine();
            if (string.IsNullOrWhiteSpace(fio))
            {
                Console.WriteLine("Ім'я не введено. Скасовано.");
                return;
            }

            // повідомлення — студент доданий
            Console.WriteLine($"Студент '{fio}' був доданий.");
        }

        // 10. Відрахувати студента (вибір номера 1..5)
        static void ExpelStudentByNumber()
        {
            Console.Write("Введіть порядковий номер студента для відрахування (1..5): ");
            if (!int.TryParse(Console.ReadLine(), out int id) || id < 1 || id > 5)
            {
                Console.WriteLine("Некоректний номер.");
                return;
            }

            var s = students.FirstOrDefault(x => x.Id == id);
            if (s == null)
            {
                Console.WriteLine("Студента з таким номером немає.");
                return;
            }

            Console.WriteLine($"Студент #{s.Id} {s.FullName} був відрахований.");
        }
    }
}
